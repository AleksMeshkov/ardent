{"tagline":"Self-validating, secure and smart models for Laravel 4's Eloquent O/RM","note":"Don't delete this file! It's used internally to help with page regeneration.","name":"Ardent","body":"#Ardent\r\n\r\nSelf-validating smart models for Laravel Framework 4's Eloquent O/RM.\r\n\r\nBased on the Aware bundle for Laravel 3 by Colby Rabideau.\r\n\r\nCopyright (C) 2013 Max Ehsan <[http://laravelbook.com/](http://laravelbook.com/)>\r\n\r\n##Installation\r\n\r\nAdd `laravelbook/ardent` as a requirement to `composer.json`:\r\n\r\n```javascript\r\n{\r\n    \"require\": {\r\n        \"laravelbook/ardent\": \"1.0.*\"\r\n    }\r\n}\r\n```\r\n\r\nUpdate your packages with `composer update` or install with `composer install`.\r\n\r\n## Documentation\r\n\r\n* [Introduction](#intro)\r\n* [Getting Started](#start)\r\n* [Effortless Validation with Ardent](#validation)\r\n* [Retrieving Validation Errors](#errors)\r\n* [Overriding Validation](#override)\r\n* [`beforeSave` and `afterSave` Hooks](#beforesave)\r\n* [Custom Validation Error Messages](#messages)\r\n* [Custom Validation Rules](#rules)\r\n* [Automatically Hydrate Ardent Entities](#hydra)\r\n* [Automatically Purge Redundant Form Data](#purge)\r\n* [Automatically Transform Secure-Text Attributes](#secure)\r\n\r\n<a name=\"start\"></a>\r\n## Introduction\r\n\r\nHow often do you find yourself re-creating the same boilerplate code in the applications you build? Does this typical form processing code look all too familiar to you?\r\n\r\n```php\r\nRoute::post( 'register', function () {\r\n        $rules = array(\r\n            'name'      => 'required|min:3|max:80|alpha_dash',\r\n            'email'     => 'required|between:3,64|email|unique:users',\r\n            'password'  =>'required|alpha_num|between:4,8|confirmed',\r\n            'password_confirmation'=>'required|alpha_num|between:4,8'\r\n        );\r\n\r\n        $validator = Validator::make( Input::all(), $rules );\r\n\r\n        if ( $validator->passes() ) {\r\n            User::create( array(\r\n                    'name'      => Input::get( 'real_name' ),\r\n                    'email'     => Input::get( 'email' ),\r\n                    'password'  => Hash::make( Input::get( 'password' ) )\r\n                ) );\r\n\r\n            return Redirect::to( '/' )->with( 'message', 'Thanks for registering!' );\r\n        } else {\r\n            return Redirect::to( '/' )->withErrors( $v->getMessages() );\r\n        }\r\n    }\r\n);\r\n```\r\n\r\nImplementing this yourself often results in a lot of repeated boilerplate code. As an added bonus, you controllers (or route handlers) get prematurely fat, and your code becomes messy, ugly and difficult to understand.\r\n\r\nWhat if someone else did all the heavy-lifting for you? What if, instead of regurgitating the above mess, all you needed to type was these few lines?...\r\n\r\n```php\r\nRoute::post( 'register', function () {\r\n        $user = new User;\r\n        if ( $user->save() ) {\r\n            return Redirect::to( '/' )->with( 'message', 'Thanks for registering!' );\r\n        } else {\r\n            return Redirect::to( '/' )->withErrors( $user->errors() );\r\n        }\r\n    }\r\n);\r\n```\r\n\r\n**Enter Ardent!** \r\n\r\n**Ardent** - the magic-dust-powered, wrist-friendly, one-stop solution to all your dreary input sanitization boilerplates!\r\n\r\nPuns aside, input validation functionality can quickly become tedious to write and maintain. Ardent deals away with these complexities by providing helpers for automating many repetitive tasks.\r\n\r\nArdent is not just great for input validation, though - it will help you significantly reduce your Eloquent data model code. Ardent is particularly useful if you find yourself wearily writing very similar code time and again in multiple individual applications.\r\n\r\nFor example, user registration or blog post submission is a common coding requirement that you might want to implement in one application and reuse again in other applications. With Ardent, you can write your *self-aware, smart* models just once, then re-use them (with no or very little modification) in other projects. Once you get used to this way of doing things, you'll honestly wonder how you ever coped without Ardent.\r\n\r\n**No more repetitive brain strain injury for you!**\r\n\r\n<a name=\"start\"></a>\r\n## Getting Started\r\n\r\n`Ardent` aims to extend the `Eloquent` base class without changing its core functionality. Since `Ardent` itself is a descendant of `Illuminate\\Database\\Eloquent\\Model`, all your `Ardent` models are fully compatible with `Eloquent` and can harness the full power of Laravels awesome OR/M.\r\n\r\nTo create a new Ardent model, simply make your model class derive from the `Ardent` base class:\r\n\r\n```php\r\nclass User extends Ardent {}\r\n```\r\n\r\n> **Note:** You can freely *co-mingle* your plain-vanilla Eloquent models with Ardent descendants. If a model object doesn't rely upon user submitted content and therefore doesn't require validation - you may leave the Eloquent model class as it is.\r\n\r\n<a name=\"validation\"></a>\r\n## Effortless Validation with Ardent\r\n\r\nArdent models use Laravel's built-in [Validator class](http://doc.laravelbook.com/validation/). Defining validation rules for a model is simple and is typically done in your model class as a static variable:\r\n\r\n```php\r\nclass User extends Ardent {\r\n\r\n  /**\r\n   * Ardent validation rules\r\n   */\r\n  public static $rules = array(\r\n    'name' => 'required|between:4,16',\r\n    'email' => 'required|email',\r\n\t'password' => 'required|alpha_num|between:4,8|confirmed',\r\n\t'password_confirmation' => 'required|alpha_num|between:4,8',\r\n  );\r\n\r\n  ...\r\n\r\n}\r\n```\r\n\r\nArdent models validate themselves automatically when `Ardent->save()` is called.\r\n\r\n```php\r\n$user = new User;\r\n$user->name = 'John doe';\r\n$user->email = 'john@doe.com';\r\n$user->password = 'test';\r\n$success = $user->save(); // returns false if model is invalid\r\n```\r\n\r\n> **Note:** You can also validate a model at any time using the `Ardent->validate()` method.\r\n\r\n<a name=\"errors\"></a>\r\n## Retrieving Validation Errors\r\n\r\nWhen an Ardent model fails to validate, a `Illuminate\\Support\\MessageBag` object is attached to the Ardent object which contains validation failure messages.\r\n\r\nRetrieve the validation errors message collection instance with `Ardent->errors()` method or `Ardent->validationErrors` property.\r\n\r\nRetrieve all validation errors with `Ardent->errors()->all()`. Retrieve errors for a *specific* attribute using `Ardent->validationErrors->get('attribute')`.\r\n\r\n> **Note:** Ardent leverages Laravel's MessagesBag object which has a [simple and elegant method](http://doc.laravelbook.com/validation/#working-with-error-messages) of formatting errors.\r\n\r\n<a name=\"overide\"></a>\r\n## Overriding Validation\r\n\r\nThere are two ways to override Ardent's validation:\r\n\r\n#### 1. Forced Save\r\n`forceSave()` validates the model but saves regardless of whether or not there are validation errors.\r\n\r\n#### 2. Override Rules and Messages\r\nboth `Ardent->save($rules, $customMessages)` and `Ardent->validate($rules, $customMessages)` take two parameters:\r\n\r\n- `$rules` is an array of Validator rules of the same form as `Ardent::rules`.\r\n- The same is true of the `$customMessages` parameter (same as `Ardent::customMessages`)\r\n\r\nAn array that is **not empty** will override the rules or custom error messages specified by the class for that instance of the method only.\r\n\r\n> **Note:** the default value for `$rules` and `$customMessages` is empty `array()`, if you pass an `array()` nothing will be overriden.\r\n\r\n<a name=\"beforesave\"></a>\r\n## beforeSave and afterSave Hooks\r\n\r\nArdent provides a convenient method for performing actions when `$model->save()` is called. For example, you may use `beforeSave` to hash a users password:\r\n\r\n```php\r\nclass User extends Ardent {\r\n\r\n\tpublic function beforeSave( $forced )\r\n\t{\r\n\t\t// if there's a new password, hash it\r\n\t\tif($this->changed('password'))\r\n\t\t{\r\n\t\t\t$this->password = Hash::make($this->password);\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t\t}\r\n\t\r\n}\r\n```\r\n\r\nNotice that `beforeSave` returns a boolean. If you'd like to halt the `save()` operation, simply return `false`.\r\n\r\n### Overriding beforeSave and afterSave\r\n\r\nJust like, `$rules` and `$customMessages`, `beforeSave` and `afterSave` can be overridden at run-time. Simply pass the closures to the `save()` (or `forceSave()`) function.\r\n\r\n```php\r\n$user->save(array(), array(), \r\n\tfunction ($model) {\t// closure for beforeSave\r\n\t\techo \"saving the model object...\";\r\n\t\treturn true;\r\n\t},\r\n\tfunction ($model) {\t// closure for afterSave\r\n\t\techo \"done!\";\r\n\t}\r\n);\r\n```\r\n\r\n> **Note:** the closures should have one parameter as it will be passed a reference to the model being saved.\r\n\r\n<a name=\"messages\"></a>\r\n## Custom Error Messages\r\n\r\nJust like the Laravel Validator, Ardent lets you set custom error messages using the [same sytax](http://doc.laravelbook.com/validation/#custom-error-messages).\r\n\r\n```php\r\nclass User extends Ardent {\r\n\r\n  /**\r\n   * Ardent Messages\r\n   */\r\n  public static $customMessages = array(\r\n    'required' => 'The :attribute field is required.'\r\n  );\r\n\r\n  ...\r\n\r\n}\r\n```\r\n\r\n<a name=\"rules\"></a>\r\n## Custom Validation Rules\r\n\r\nYou can create custom validation rules the [same way](http://doc.laravelbook.com/validation/#custom-validation-rules) you would for the Laravel Validator.\r\n\r\n<a name=\"hydra\"></a>\r\n## Automatically Hydrate Ardent Entities\r\n\r\nArdent is capable of hydrating your entity model class from the form input submission automatically! \r\n\r\nLet's see it action. Consider this snippet of code:\r\n\r\n```php\r\n$user = new User;\r\n$user->name = Input::get('name');\r\n$user->email = Input::get('email');\r\n$user->password = Hash::make(Input::get('password'));\r\n$user->save();\r\n```\r\n\r\nLet's invoke the *magick* of Ardent and rewrite the previous snippet:\r\n\r\n```php\r\n$user = new User;\r\n$user->save();\r\n```\r\n\r\nThat's it! All we've done is remove the boring stuff.\r\n\r\nBelieve it or not, the code above performs essentially the same task as its older, albeit rather verbose sibling. Ardent populates the model object with attributes from user submitted form data (it uses the Laravel `Input::all()` method internally). No more hair-pulling trying to find out which Eloquent property you've forgotten to populate. Let Ardent take care of the boring stuff, while you get on with the fun stuffs!\r\n\r\nTo enable the auto-hydration feature, simply set the `$autoHydrateEntityFromInput` instance variable to `true` in your model class:\r\n\r\n```php\r\nclass User extends Ardent {\r\n\r\n  public $autoHydrateEntityFromInput = true;\r\n\r\n}\r\n```\r\n\r\n<a name=\"purge\"></a>\r\n## Automatically Purge Redundant Form Data\r\n\r\nArdent models can *auto-magically* purge redundant input data (such as *password confirmation* fields) - so that the extra data is never saved to database. Ardent will use the confirmation fields to validate form input, then prudently discard these attributes before saving the model instance to database!\r\n\r\nTo enable this feature, simply set the `$autoPurgeRedundantAttributes` instance variable to `true` in your model class:\r\n\r\n```php\r\nclass User extends Ardent {\r\n\r\n  public $autoPurgeRedundantAttributes = true;\r\n\r\n}\r\n```\r\n\r\n<a name=\"secure\"></a>\r\n## Automatically Transform Secure-Text Attributes\r\n\r\nSuppose you have an attribute named `password` in your model class, but don't want to store the plain-text version in the database. The pragmatic thing to do would be to store the hash of the original content. Worry not, Ardent is fully capable of transmogrifying any number of secure fields automatically for you!\r\n\r\nTo do that, add the attribute name to the `Ardent::$passwordAttributes` static array variable in your model class, and set the `$autoHashPasswordAttributes` instance variable to `true`:\r\n\r\n```php\r\nclass User extends Ardent {\r\n\r\n  public static $passwordAttributes = array('password');\r\n\r\n  public $autoHashPasswordAttributes = true;\r\n\r\n}\r\n```\r\n\r\nArdent will automatically replace the plain-text password attribute with secure hash checksum and save it to database. It uses the Laravel `Hash::make()` method internally to generate hash.","google":"UA-37509080-3"}